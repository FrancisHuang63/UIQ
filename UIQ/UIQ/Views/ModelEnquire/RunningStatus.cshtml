@using UIQ.Controllers
@using UIQ.ViewModels

@{
    Layout = null;
    IEnumerable<ModelLogFileViewModel> configList = ViewBag.ConfigList;
}

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script src="~/js/jquery-1.3.2.min.js"></script>
<script src="~/js/tool.js"></script>
<link rel=stylesheet type="text/css" href="~/css/style.css">
<link rel=stylesheet type="text/css" href="~/css/fjstyle.css">

<!DOCTYPE html>
<html lang="zh-hant">
	<head><title>Runnning status</title></head>
	
	<script type="text/javascript">
		function countSecond()
		{
			setTimeout("ReRunSend()", 10000);
		}

		function ReRunSend()
		{
			if(document.getElementById("SendMember") != null)
			{
				if(document.all) {
						document.getElementById("SendMember").click();
				}
			
				else {
					var e = document.createEvent("MouseEvents");
					e.initEvent("click", true, true);
					document.getElementById("SendMember").dispatchEvent(e);
				}
			}
			setTimeout("ReRunSend()", 10000);
		}
	</script>
	<body>
		<div class='topic'>Model enquire > Running status</div>
			<form Name="myForm" action="javascript:;" class="form">
				Model:
				<select id="model" class="form">
					<option>-----</option>
					@foreach(var item in configList.GroupBy(x => x.Model_Name))
					{
						<option value="@item.Key">@item.Key</option>
					}
				</select>

				Member:
				<select id="member" class="form" OnChange="build_nickname_options();">
					<option>-----</option>
				</select>

				 Nickname:
				<select id="nickname" class="form" OnChange="sendAJAXRequest('post', '@(Url.Action(nameof(GetHtmlController.RunningEnquire), "GetHtml"))', 'LogShow'); sendAJAXRequest('post', '@(Url.Action(nameof(GetHtmlController.RunningSms), "GetHtml"))', 'sms');">
					<option>-----</option>
				</select>

				KeyWord:
				<input id="keyw" class="form" value="job" OnChange="sendAJAXRequest('post', '@(Url.Action(nameof(GetHtmlController.RunningEnquire), "GetHtml"))', 'LogShow');">

				<div id="LogShow" class="form">
					LogFile:
					<select class="form">
						<option>-----</option>
					</select>
					<input type="submit" value="enquire" class="form" >
				</div>
				<br>
				<h1>show the log file of the member</h1>
				<div id="show" class="enquire">show the current status...</div>
			</form>

			<script type="text/JavaScript">
				function clearSelectOption(elementId){
					$(`#${elementId}`).html('<option>-----</option>')
				}

				$('#model').change(function(){
					let selValue = $(this).val();
					clearSelectOption('member');
					$.ajax({
						url: '@Url.Action(nameof(ModelEnquireController.GetMemberItems), "ModelEnquire")',
						type: 'POST',
						data: { modelName : selValue },
						dataType: "json",
						success: function(resp){
							if(resp.length == 0 || resp.success == false){
								clearSelectOption('nickName');
							}
							else{
								Array.from(resp.data).forEach(item => $('#member').append(`<option value="${item}">${item}</option>`));
							}
						},
						error: function(){
							clearSelectOption('nickName');
						}
					});
				});
			</script>
	</body>
</html>

