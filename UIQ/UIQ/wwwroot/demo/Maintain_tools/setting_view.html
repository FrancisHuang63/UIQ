<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<script type="text/javascript" src="../../js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="../../packages/jquery-ui-1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="../../js/apprise-1.5.full.js"></script>
<script type="text/javascript" src="../../js/tool.js"></script>
<script type="text/javascript" src="../../packages/jquery-flexselect/jquery.flexselect.js"></script>
<script type="text/javascript" src="../../packages/jquery-flexselect/liquidmetal.js"></script>
<script type="text/javascript" src="../../js/setting.js"></script>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../../packages/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="../../css/style.css" rel="stylesheet" type="text/css" />
<link href="../../css/jqueryslidemenu.css" rel="stylesheet" type="text/css" />
<link href="../../css/apprise.css" rel="stylesheet" type="text/css" />
<link href="../../packages/jquery-flexselect/flexselect.css" rel="stylesheet" type="text/css" />


<title>Model & Member Setting</title>
</head>
<body>
<div id="loading"><img src="../../images/clock.gif"></div>
<div class=topic>Model & Member Setting</div>
<br>
<h1> This Page id used to ADD a NEW MODEL & MEMBER</h1>
<div>
<input id='memberID' type='hidden' name='memberID' value='$id'>

<form id='setting' name='setting' action='<?php if (isset($id)){ echo "../update";} else { echo "./save";}?>' method='post' autocomplete='off'>

    <div class="check_point_dialog" id="check_point_dialog" title="Check Points" style="display:none">
        <table width='100%' border='1'>
            <thead>
                <tr>
                    <th id="batch_name" width=65%></th>
                    <th id="add_check_btn" width=35%>
                        <a type="button" id="addCheckPoint" class="btn_default">
                        <img src="../../images/add_icons.png" alt="新增"/>
                        Add Check Point
                        </a>
                    </th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

<table width='85%' border='1'>
    <thead>
        <tr>
            <th>Name</th>
            <th width=80%>Setting</th>
        </tr>
    </thead>
    <tbody>
        <tr>
			<td>Model Set</td>
            <td>
				<table>
					<tr>
						<td>
							<input type="radio" name="model_rd" value="def">Old Model Name<font color='red'>*</font>：
						</td>
						<td>
							<select id="model_select" name="model_select">
								<option></option>
							</select>
							<input type='button' value='DelModel' onclick='deleteModelCheck()'>
						</td>
					</tr>
					<tr>
						<td><input type="radio" name="model_rd" value="input" />New Model Name<font color='red'>*</font>：</td>
						<td><input type="text" name="model_input">(Ex: NFS)</td></tr>
					<tr>
						<td>Model Position<font color='red'>*</font>：</td>
						<td><input type="text" name="model_position" value="<?= $model_position?>">(Ex: 24)</td>
					</tr>
					<input type="hidden" name="model_id" value="<?= $new_model_id?>"><!-- get the Max value -->
					<input type="hidden" name="new_model_position" value="<?= $new_model_position?>"><!-- get the Max value -->
            	</table>
			</td>
        </tr>
		<tr>
			<td>Member Set</td>
            <td>
				<table>
					<tr>
						<td>Member Name<font color='red'>*</font>：</td>
						<td>
							<input type="text" name="member_input" value="<?= $member_name ?>">(Ex: M03)
							<input type="hidden" name="member_id" value="<?php if (isset($id)){ echo $id;} else {echo $new_member_id;}?>"><!-- get the Max value -->
						</td>
					</tr>
					<tr>
						<td>Member Nickname<font color='red'>*</font>：</td>
						<td><input type="text" name="member_nickname" value="<?= $nickname?>"></td>
					</tr>
					<tr>
						<td>Member Position<font color='red'>*</font>：</td>
						<td><input type="text" name="member_position" value="<?= $member_position ?>">(Ex: 24)</td>
					</tr>
					<tr>
						<td>Member Account<font color='red'>*</font>：</td>
						<td><input type="text" name="member_account" value="<?= $account ?>">(Ex: npcaxxx)</td>
					</tr>
					<tr>
						<td>Member Path：</td>
						<td><input type="text" name="member_path" value="<?= $member_path ?>">(Ex: /ncs/npcaxxx/<font color='red'>MemberPath</font>/NFS/M03)</td>
					</tr>
					<tr>
						<td>Dtg Value<font color='red'>*</font>：</td>
						<td><input type="text" name="member_dtg_value" value="<?= $dtgvalue ?>">(Ex: 6 or 12 or 24)</td>
					</tr>
					<tr>
						<td>Group Member Name：</td>
						<td><input type="text" name="model_group" value="<?= $model_group ?>">(Ex: M01 TWRF or M03 caa)</td>
					</tr>
					<tr>
						<td>Member Reset：</td>
						<td><input type="text" name="member_reset_model" value="<?= $reset_model ?>">(Ex: cgibin/KillJob.ksh)</td>
					</tr>
					<tr>
						<td>Member Dtg Adjust：</td>
						<td><input type="text" name="member_dtg_adjust" value="<?= $dtg_adjust ?>">(Ex: bin/setdtg.sh)</td>
					</tr>
					<tr>
						<td>Member Fix：</td>
						<td><input type="text" name="member_fix_fialed_model" value="<?= $fix_failed_model ?>">(Ex: cgibin/Rescue.ksh)</td>
					</tr>
					<tr>
						<td>Member Submit：</td>
						<td><input type="text" name="member_submit_model" value="<?= $submit_model ?>">(Ex: cgibin/ReRun.ksh)</td>
					</tr>
					<tr>
						<td>Normal Prediction Time：</td>
						<td><input type="text" name="member_normal_pre_time" value="<?= $normal_pre_time ?>">(Ex: 300)</td>
					</tr>
					<tr>
						<td>Typhoon Prediction Time：</td>
						<td><input type="text" name="member_typhoon_pre_time" value="<?= $typhoon_pre_time ?>">(Ex: 300)</td>
					</tr>
					<tr>
						<td>About Typhoon：</td>
						<td><input type="checkbox" id="typhoon_model" name="typhoon_model" ></td>
					</tr>
				</table>
			</td>
        </tr>
        <tr>
			<td>Cron Table<img src="../../images/add_icons.png" onclick="addSatnamingCronGroup()" alt="新增"/></td>
            <td>
				<table id="crontabTable"><!-- "+" & "-" -->
				<tr>
					<table id="crongrpTable_Normal" border=1><th bgcolor=lightcyan>Normal<img src="../../images/add_icons.png" onclick="addSatnamingCrontab('Normal')" alt="新增"/>
						<tr>
							<td id="crontab_0"><input id="crontabInput_0" name="crontabInput_0" type="text" value="">(Ex: 17:00:00)<img src="../../images/delete_icons.png" onclick="deleteSatnamingCrontab('crontab_0')" alt="移除"/></td> 
							<input id="crontab_gid_<?= $crontabRowNum?>" name="crontab_gid_<?= $crontabRowNum?>" type="hidden" value="Normal">
						</tr>
					</table>
				</tr>
			</td>
        </tr>
		<tr>
			<td>Batch<img src="../../images/add_icons.png" onclick="addSatnamingBatch()" alt="新增"/></td>
            <td>
				<table id="batchTable" border='1' frame='below'>
                    <td id="batch_0">
                        <table width='100%'>
                            <tr>
                                <td>Batch Position<font color='red'>*</font></td>
                                <td>
                                    <input id="batchInputPosition_0" name="batchInputPosition_0" type="text" value="">(Ex: 1, 2 ,3)
                                    <img src="../../images/delete_icons.png" onclick="deleteSatnamingBatch('batch_0')" alt="移除" align="right"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Name<font color='red'>*</font></td>
                                <td>
                                    <input class='batchName' id="batchInputName_0" name="batchInputName_0" type="text" size="17" value="">
                                    <input id="batchInputRelay_0" name="batchInputRelay_0" type="checkbox" value="1">(Ex: Rnwpnfs1&是否為中繼點)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Type</td>
                                <td>
                                    <input id="batchInputType_0" name="batchInputType_0" type="text" value="">(Ex: Major, Post)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Dtg</td>
                                <td>
                                    <input id="batchInputDtg_0" name="batchInputDtg_0" type="text" value="">(Ex: 00, 06)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Time<font color='red'>*</font></td>
                                <td>
                                    <input id="batchInputTime_0" name="batchInputTime_0" type="text" size="15" value="">分鐘&nbsp;(Ex: 44)
                                </td>
                            </tr>
                            <tr>
                                <td>Check Point<img id="showCheckPoint" src="../../images/add_icons.png" alt="新增"/></td>
                                <td></td>
                            </tr>
                        </table>
                    </td>
				</table>
				<table id="batchTable" border='1' frame='below'>
                    <td id="batch_0">
                        <table width='100%'>
                            <tr>
                                <td>Batch Position<font color='red'>*</font></td>
                                <td>
                                    <input id="batchInputPosition_0" name="batchInputPosition_0" type="text" value="">(Ex: 1, 2 ,3)
                                    <img src="../../images/delete_icons.png" onclick="deleteSatnamingBatch('batch_0')" alt="移除" align="right"/>
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Name<font color='red'>*</font></td>
                                <td>
                                    <input class='batchName' id="batchInputName_0" name="batchInputName_0" type="text" size="17" value="">
                                    <input id="batchInputRelay_0" name="batchInputRelay_0" type="checkbox" value="1">(Ex: Rnwpnfs1&是否為中繼點)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Type</td>
                                <td>
                                    <input id="batchInputType_0" name="batchInputType_0" type="text" value="">(Ex: Major, Post)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Dtg</td>
                                <td>
                                    <input id="batchInputDtg_0" name="batchInputDtg_0" type="text" value="">(Ex: 00, 06)
                                </td>
                            </tr>
                            <tr>
                                <td>Batch Time<font color='red'>*</font></td>
                                <td>
                                    <input id="batchInputTime_0" name="batchInputTime_0" type="text" size="15" value="">分鐘&nbsp;(Ex: 44)
                                </td>
                            </tr>
                            <tr>
                                <td>Check Point<img id="showCheckPoint" src="../../images/add_icons.png" alt="新增"/></td>
                                <td></td>
                            </tr>
                        </table>
                    </td>
				</table>
			</td>
			
		</tr>
		<tr><td>Archive<img src="../../images/add_icons.png" onclick="addSatnamingArchive()" alt="新增"/></td>
            <td><table id="archiveTable">
                <tr>
                    <td id='archive_<?= $archiveRowNum ?>'>Target Directory：
                        <input class='archive_directory' id='archive_directory_<?= $archiveRowNum ?>' type='text' name='archive_directory_<?= $archiveRowNum ?>' value='<?= $target_directory_i ?>'>
                    </td>
                <tr>
                <tr>
                    <td id="archive_<?= $archiveRowNum ?>">
                        <select name="archive_data_<?= $archiveRowNum ?>"><?= $data_option ?></select>
                        <input id="archiveInput_<?= $archiveRowNum ?>" name="archiveInput_<?= $archiveRowNum ?>" type="text" value="<?= substr($archive[$i]['archive_redo'],1) ?>">
                        <img src="../../images/delete_icons.png" onclick="deleteSatnamingArchive('archive_<?= $archiveRowNum ?>')" alt="移除"/>
                    </td>
                </tr>
                <tr>
                    <td id='archive_0'>Target Directory：
                        <input class='archive_directory' id='archive_directory_0' type='text' name='archive_directory_0'>
                    </td>
                <tr>
				<tr><td id="archive_0">
                <select name="archive_data_0"><?= $data_option ?></select><input id="archiveInput_0" name="archiveInput_0" type="text" value="">(Ex: bin/Rarchive<font color='red'>xxx</font>.ksh)<img src="../../images/delete_icons.png" onclick="deleteSatnamingArchive('archive_0')" alt="移除"/></td></tr>
			<tr>
			</table>
			<input id="archiveRowNum" type="hidden" name="archiveRowNum" value="<?= $archiveRowNum ?>"></td>
        </tr>
		<tr><td>Output<img src="../../images/add_icons.png" onclick="addSatnamingOutput()" alt="新增"/></td>
            <td><table id="outputTable">
				<tr><td id="output_<?= $outputRowNum?>"><select name="output_work_<?= $outputRowNum?>"><?= $work_option ?></select><input id="outputInput_<?= $outputRowNum?>" name="outputInput_<?= $outputRowNum?>" type="text" value="<?= substr($output[$i]['model_output'],1)?>"><img src="../../images/delete_icons.png" onclick="deleteSatnamingOutput('output_<?= $outputRowNum?>')" alt="移除"/></td></tr>
				<tr><td id="output_0"><select name="output_work_0"><?= $work_option ?></select><input id="outputInput_0" name="outputInput_0" type="text" value="">(Ex: bin/R<font color='red'>xxx</font>.ksh)<img src="../../images/delete_icons.png" onclick="deleteSatnamingOutput('output_0')" alt="移除"/></td></tr>
			</table>
			<input id="outputRowNum" type="hidden" name="outputRowNum" value="<?= $outputRowNum?>"></td>
        </tr>
        <tr>
            <td>maintainer Setting</td>
            <td>
                <input id="maintainer_status" type="radio" name="maintainer_status" value="0" checked> on
                <input id="maintainer_status" type="radio" name="maintainer_status" value="2" > maintainer
            </td>
        </tr>
    </tbody>
</table>
<input type='submit' value='Update'>
<input type='submit' value='Add'>
<input type='button' value='Delete' onclick='deleteCheck()'>

</form>
</div>

<script>
function addSatnamingCrontab(gid){
	var table = 'crontab';
	var gtbl = 'crongrpTable_'+gid;
	var num = document.getElementById("crontabRowNum").value;
	var otr = document.getElementById(gtbl).insertRow(-1);
	var otd = document.createElement("td");
	otd.id = table+'_'+num ;
	otd.innerHTML='<input id="'+ table +'Input_'+ num +'" name="'+table+'Input_'+ num +'" type="text"><img src="../../images/delete_icons.png" onclick="deleteSatnamingCrontab(\''+ gtbl +'\', \''+table+'_'+ num +'\')" alt="移除"/>';
	otd.innerHTML+='<input id="crontab_gid_'+ num +'" name="crontab_gid_'+ num + '" type="hidden" value=' + gid + '>';
	otr.appendChild(otd);
	document.getElementById("crontabRowNum").value = parseInt(num) + 1;
}

function addSatnamingCronGroup(){
	var table = 'crontab';
	var num = document.getElementById("crontabRowNum").value;
	var otr = document.getElementById("crontabTable").insertRow(-1);
	var otd = document.createElement("td");
	otd.id = table+'_'+num ;
	otd.innerHTML='<table id="crongrpTable_'+ num + '" border=1><th bgcolor=lightcyan align=left>New Mode name:<br><input type="text" name="crontab_gid_' + num + '" id="crontab_gid_' + num +'"><tr><td id="crontab_'+ num + '">New Cron time:<br><input id="crontabInput_' + num + '" name="crontabInput_' + num + '" type="text" value=""></table>';
	otr.appendChild(otd);
	document.getElementById("crontabRowNum").value = parseInt(num) + 1;
}

function deleteSatnamingCrontab(tbl, str){
	var td = document.getElementById(str).parentNode.rowIndex;
	document.getElementById(tbl).deleteRow(td)
}

function addSatnamingBatch(){
	var table = 'batch';
	var num = document.getElementById("batchRowNum").value;
	var otr = document.getElementById("batchTable").insertRow(-1);
	var otd = document.createElement("td");
	otd.id = table+'_'+num ;
	otd.innerHTML='<table><tr><td>Batch Position<font color="red">*</font></td><td><input id="batchInputPosition_'+num+'" name="batchInputPosition_'+num+'" type="text" value=""><img src="../../images/delete_icons.png" onclick="deleteSatnamingBatch(\'batch_'+num+'\')" alt="移除" align="right"/></td></tr><tr><td>Batch Name<font color="red">*</font></td><td><input class="batchName"  id="batchInputName_'+num+'" name="batchInputName_'+num+'" type="text" size="17" value=""><input id="batchInputRelay_'+num+'" name="batchInputRelay_'+num+'" type="checkbox" value="1"></td></tr><tr><td>Batch Type</td><td><input id="batchInputType_'+num+'" name="batchInputType_'+num+'" type="text" value=""></td></tr><tr><td>Batch Dtg</td><td><input id="batchInputDtg_'+num+'" name="batchInputDtg_'+num+'" type="text" value=""></td></tr><tr><td>Batch Time<font color="red">*</font></td><td><input id="batchInputTime_'+num+'" name="batchInputTime_'+num+'" type="text" size="15" value="">分鐘</td></tr><tr><td>Check Point<img id="showCheckPoint" src="../../images/add_icons.png"" alt="新增"/></td><td></td></tr></table>';
	otr.appendChild(otd);
	document.getElementById("batchRowNum").value = parseInt(num) + 1;
}

function deleteSatnamingBatch(str,row_num){
	var td = document.getElementById(str).parentNode.rowIndex;
	document.getElementById('batchTable').deleteRow(td);
        $('div[aria-describedby="check_point_dialog_'+row_num+'"]').remove();
}

function addSatnamingArchive(){
	var table = 'archive';
	var num = document.getElementById("archiveRowNum").value;
	var otr_directory = document.getElementById("archiveTable").insertRow(-1);
        var otr_option = document.getElementById("archiveTable").insertRow(-1);
        var otd_directory = document.createElement("td");
 	var otd_option = document.createElement("td");

        otd_directory.id = table+'_'+num ;
        otd_directory.innerHTML = 'Target Directory：<input class="archive_directory" id="' + table + '_directory_' + num + '" type="text" name="' + table + '_directory_' + num + '">';
        otr_directory.appendChild(otd_directory);

        otd_option.id = table+'_'+num ;
	otd_option.innerHTML='<select name="'+ table +'_data_'+ num +'"><?= $data_option ?></select><input id="'+ table +'Input_'+ num +'" name="'+table+'Input_'+ num +'" type="text"><img src="../../images/delete_icons.png" onclick="deleteSatnamingArchive(\''+table+'_'+ num +'\')" alt="移除"/>';
	otr_option.appendChild(otd_option);

	document.getElementById("archiveRowNum").value = parseInt(num) + 1;
}

function deleteSatnamingArchive(str){
	var td = document.getElementById(str).parentNode.rowIndex;
	document.getElementById('archiveTable').deleteRow(td);

        $('#'+str).remove();
}

function addSatnamingOutput(){
	var table = 'output';
	var num = document.getElementById("outputRowNum").value;
	var otr = document.getElementById("outputTable").insertRow(-1);
	var otd = document.createElement("td");
	otd.id = table+'_'+num ;
	otd.innerHTML='<select name="'+ table +'_work_'+ num +'"><?= $work_option ?></select><input id="'+ table +'Input_'+ num +'" name="'+table+'Input_'+ num +'" type="text"><img src="../../images/delete_icons.png" onclick="deleteSatnamingOutput(\''+table+'_'+ num +'\')" alt="移除"/>';
	otr.appendChild(otd);
	document.getElementById("outputRowNum").value = parseInt(num) + 1;
}

function deleteSatnamingOutput(str){
	var td = document.getElementById(str).parentNode.rowIndex;
	document.getElementById('outputTable').deleteRow(td);
}

function deleteModelCheck(){
	if (confirm('Do You Want to Delete This Model ?\n\n(ALL the Members of this Model will be DELETE!)')){
		if (confirm('Are You Sure Delete This Model ?')){
			document.setting.action = '<?php if (isset($id)){ echo ".";}?>./deleteModel';
			document.setting.submit();
		}
	}
}

function deleteCheck(){
	if (confirm('Do You Want to Delete This Member ?')){
		document.setting.action = '../delete';
		document.setting.submit();
	}
}
</script>
</body>
