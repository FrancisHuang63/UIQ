<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
 <link rel="stylesheet" href="../../css/style.css" type="text/css">
<script src="../js/jquery-1.3.2.min.js"></script>
<script src="../js/tool.js"></script>
<TITLE>NWP runnning jobs</Title>
<div class=topic>System enquire > NWP running jobs</div>
<h1>Show jobs of ncsa* accounts on compute nodes</h1>
<div class="enquire">
<pre>
<?php
require_once("../function.php");
include("../cfg/SV_PATH.php");
#system('rsh -l ${HpcCTL} ${LOGIN_IP} \'jstat | grep ncsa\'');

## Display running jobs of ncsa* and npca* users sorted by user name.
system("date");

$a1 = "No.";
$a2 = "JOB_ID";
$a3 = "JOB_NAME";
$a4 = "MD";
$a5 = "ST";
$a6 = "USER";
$a7 = "START_DATE";
$a8 = "ELAPSE_LIM";
$a9 = "NODE_REQUIRE";
$running_info = ${RUNNING_JOB_INFO};
foreach ($running_info as $fx_number => $value){
    printf ("\n%3s", $fx_number);
    
    foreach ($value as $key => $login_info){
        $login_ip = $login_info['LOGIN_IP'];
        $login_name = $login_info['NAME'];
        $account_prefix = $login_info['PREFIX'];
        printf ("\n%6s", $login_name);
        printf ("\n%6s %11s %30s %6s %6s %20s %15s %10s %12s\n", ${a1},${a2},${a3},${a4},${a5},${a6},${a7},${a8},${a9});
        
        $command = "rsh -l ${HpcCTL} ${login_ip} 'sh ${UI_PATH}hpc_enquire/pjstat_wrapper.sh' | grep ${account_prefix} | sort -k 5 | cat -n | sed 's/\t/ /'";
       system($command);
    }
}

show_complete_msg();
?>
</pre>
</div><br>

<h1>Show processes of accounts on DATAMOVER:
<SELECT id="node" class="form" OnChange="sendAJAXRequest('post', 'nwp_running_nodes.php', 'show');">

<?php
$MYHOST=`hostname`;
$MYHOST=rtrim($MYHOST);
print "<option value=0>-----";

switch ($MYHOST) {
case "datamv03":
case "datamv04":
	print "<option value='datamv01'>datamv01";
	print "<option value='datamv02'>datamv02";
	print "<option value='datamv03'>datamv03";
	print "<option value='datamv04'>datamv04";
	print "<option value='datamv01,datamv02,datamv03,datamv04'>ALL";
	break;

case "datamv05":
case "datamv06":
	print "<option value='datamv05'>datamv05";
	print "<option value='datamv06'>datamv06";
	print "<option value='datamv05,datamv06'>ALL";
	break;

case "login11":
case "login12":
        print "<option value='login11'>login11";
        print "<option value='login12'>login12";
        print "<option value='login11,login12'>ALL";
        break;

case "login15":
case "login16":
        print "<option value='login15'>login15";
        print "<option value='login16'>login16";
        print "<option value='login15,login16'>ALL";
        break;

case "h6dm13":
case "h6dm14":
        print "<option value='h6dm13'>h6dm13";
        print "<option value='h6dm14'>h6dm14";
        print "<option value='h6dm13,h6dm14'>ALL";
        break;

case "h6ln13":
case "h6ln14":
        print "<option value='h6ln13'>h6ln13";
        print "<option value='h6ln14'>h6ln14";
        print "<option value='h6ln13,h6ln14'>ALL";
        break;        

case "h6dm21":
case "h6dm22":
        print "<option value='h6dm21'>h6dm21";
        print "<option value='h6dm22'>h6dm22";
        print "<option value='h6dm21,h6dm22'>ALL";
        break;

case "h6ln21":
case "h6ln22":
        print "<option value='h6ln21'>h6ln21";
        print "<option value='h6ln22'>h6ln22";
        print "<option value='h6ln21,h6ln22'>ALL";
        break; 
}
?>

</Select></h1>
<div id="show" class="enquire">
</div>
