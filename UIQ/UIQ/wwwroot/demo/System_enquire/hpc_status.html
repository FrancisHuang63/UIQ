<link rel="stylesheet" href="../../css/style.css" type="text/css">
<link rel="stylesheet" href="../../css/fjstyle.css" type="text/css">
<TITLE>HPC status</Title>
<div class=topic>System enquire > HPC system status</div>

<h1>show the water level of disks status</h1>
<div class="enquire"><pre>
<?php 
require_once("../function.php");
include("../cfg/SV_PATH.php");
#system('rsh -l ${HpcCTL} ${LOGIN_IP} \'df -k |grep /dev/nwp \'|grep -v nwpr');
system('df -k | grep -v /dev/'); 
show_complete_msg();
?>
</div>

<h1>show the node status(summary)</h1>
<div class="short"><pre>
<?php 
#system('rsh -l ${HpcCTL} ${LOGIN_IP} \'/package/local/bin/chknode\'');

## Execute pjshowrsc command and make it an array
##$pjshowrsc_s=`rsh -l ${HpcCTL} ${LOGIN_IP} 'date; pjshowrsc'`;
$pjshowrsc_s=`rsh -l ${RSH_ACCOUNT} ${LOGIN_IP} /users/xa09/bin/chknode`;
$pjshowrsc_sarr = preg_split("/\n/", $pjshowrsc_s);

foreach($pjshowrsc_sarr as $rsc){
	print "$rsc\n";
}

show_complete_msg();
?>
</div>

<h1>show the node status(detail)</h1>
<div class="huge"><pre>

<?php 
#system('rsh -l ${HpcCTL} ${LOGIN_IP} \'/package/local/bin/chknode\'');

## Execute pjshowrsc command and make it an array
$pjshowrsc_s=`rsh -l ${RSH_ACCOUNT} ${LOGIN_IP} 'date; pjshowrsc'`;
$pjshowrsc_sarr = preg_split("/\n/", $pjshowrsc_s);

## Make 5th line of pjshowrsc_s delimited by space.
$dataarr = preg_split("/\s+/", $pjshowrsc_sarr[4]);
$dataarr = array_values($dataarr);

## Get #line of nodelist.txt
$node_num = `cat nodelist.txt | wc -l`;
$node_num = rtrim($node_num);

## Comapare pjshowrsc_s result and #line of nodelist.txt 
#print "Comparing $dataarr[1] & $node_num\n";
if($dataarr[1] != $node_num){
	print "<span class=c1>Some nodes might have stopped!</span>\n";
}

## Print pjshowrsc_s result
foreach($pjshowrsc_sarr as $rsc){
	print "$rsc\n";
}

show_complete_msg();
?>

<?php
#system('rsh -l ${HpcCTL} ${LOGIN_IP} \'/package/local/bin/chkll\'');


## Read node list and make it an array
$nodelist = `cat nodelist.txt`;
$nodelist = rtrim($nodelist);
$nodelistarr = preg_split("/\n/", $nodelist);

## Execute pjshowrsc command and make it an array
$pjshowrsc_d = `rsh -l ${RSH_ACCOUNT} ${LOGIN_IP} 'date; pjshowrsc -v -E | cut -c-41'`;
$pjshowrsc_darr = preg_split("/\n/", $pjshowrsc_d);

print "${HpcCTL} ${LOGIN_IP}";

## Check if pjshowrsc_darr has all nodes.
## If so, display pjshowrsc_darr. If not, display the node name and make it red.
for($i = 0; $i < 5; $i++){
	print "$pjshowrsc_darr[$i]\n";
}
foreach($nodelistarr as $node){
	$marr = preg_grep("/$node/", $pjshowrsc_darr);
	$marr = array_values($marr);
	if(count($marr) == 1){
		print "$marr[0]\n";
	}elseif(count($marr) == 0){
		#print "<span class=c1>${node}      --      --      -    --Gi    --Gi       -    ---G    ---G       -</span>\n";
		print "<span class=c1>${node}      --      --      -    --Gi</span>\n";
	}else{
		print "<span class=c2>\"${node}\"\t??Matched 2 or more</span>\n";
	}
}
show_complete_msg();
?>
</div>
